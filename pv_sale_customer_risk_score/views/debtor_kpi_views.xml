<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- Debtors list (columns hideable with optional="show") -->
    <record id="view_pv_debtor_kpi_list" model="ir.ui.view">
        <field name="name">pv.debtor.kpi.list</field>
        <field name="model">pv.debtor.kpi</field>
        <field name="priority" eval="16"/>
        <field name="arch" type="xml">
            <list string="Debtors" create="0" edit="0" delete="0">
                <field name="commercial_partner_id"/>
                <field name="outstanding" sum="Open Invoices" optional="show"/>
                <field name="credit_open" sum="Open Credits" optional="show"/>
                <field name="overdue" sum="Overdue Invoices" optional="show"/>
                <field name="credit_limit" optional="show"/>
                <field name="credit_util_pct" optional="show"/>
                <field name="overdue_ratio" optional="show"/>
                <field name="orders_in_window" optional="show"/>
                <field name="risk_score" optional="show"/>
                <field name="risk_level" optional="show"/>
                <field name="last_updated" optional="show"/>
                <field name="company_id" optional="show"/>
            </list>
        </field>
    </record>

    <!-- Search -->
    <record id="pv_debtor_kpi_search" model="ir.ui.view">
        <field name="name">pv.debtor.kpi.search</field>
        <field name="model">pv.debtor.kpi</field>
        <field name="arch" type="xml">
            <search string="Search Debtors">
                <field name="commercial_partner_id"/>
                <field name="company_id"/>
                <filter name="overdue_only" string="Has Overdue"
                        domain="[('overdue','&gt;',0)]"/>
                <group expand="0" string="Group By">
                    <filter name="group_company" string="Company"
                            context="{'group_by':'company_id'}"/>
                    <filter name="group_level" string="Risk Level"
                            context="{'group_by':'risk_level'}"/>
                </group>
            </search>
        </field>
    </record>

    <!-- Pivot -->
    <record id="pv_debtor_kpi_pivot" model="ir.ui.view">
        <field name="name">pv.debtor.kpi.pivot</field>
        <field name="model">pv.debtor.kpi</field>
        <field name="arch" type="xml">
            <pivot string="Debtors">
                <field name="company_id" type="row"/>
                <field name="commercial_partner_id" type="row"/>
                <field name="outstanding" type="measure"/>
                <field name="credit_open" type="measure"/>
                <field name="overdue" type="measure"/>
                <field name="credit_util_pct" type="measure"/>
                <field name="overdue_ratio" type="measure"/>
                <field name="orders_in_window" type="measure"/>
                <field name="risk_score" type="measure"/>
            </pivot>
        </field>
    </record>

    <!-- Action -->
    <record id="action_pv_debtor_kpi" model="ir.actions.act_window">
        <field name="name">Debtors</field>
        <field name="res_model">pv.debtor.kpi</field>
        <field name="view_mode">list,pivot</field>
        <field name="search_view_id" ref="pv_debtor_kpi_search"/>
        <field name="context">{}</field>
        <field name="target">current</field>
    </record>

    <!-- Menu -->
    <menuitem id="menu_pv_debtors"
              name="Debtors"
              parent="account.menu_finance"
              action="action_pv_debtor_kpi"
              sequence="95"/>
</odoo>
